@using Microsoft.AspNetCore.Components.Authorization
@inherits LayoutComponentBase
@inject NavigationManager NavigationManager

<PageTitle>HBDrop - Birthday Wishes Automation</PageTitle>

<div class="dashboard-layout">
    <!-- Top Navigation Bar -->
    <nav class="dashboard-navbar">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-3">
                    <!-- Mobile Menu Toggle -->
                    <button class="mobile-menu-toggle d-md-none" @onclick="ToggleMobileMenu" type="button">
                        <span class="hamburger-icon">â˜°</span>
                    </button>
                    
                    <a href="/dashboard" class="navbar-brand">
                        <span style="font-size: 1.5rem;">ğŸ‚</span>
                        <span class="fw-bold">HBDrop</span>
                    </a>
                    <div class="nav-links d-none d-md-flex gap-3">
                        <a href="/dashboard" class="nav-link">Dashboard</a>
                        <a href="/contacts" class="nav-link">Contacts</a>
                        <a href="/messages" class="nav-link">Messages</a>
                        <a href="/whatsapp/connect" class="nav-link">WhatsApp</a>
                    </div>
                </div>
                <div class="d-none d-md-flex">
                    <AuthorizeView>
                        <Authorized>
                            <div class="d-flex align-items-center gap-3">
                                <AuthorizeView Roles="Admin" Context="adminLink">
                                    <Authorized>
                                        <a href="/admin" class="btn btn-sm btn-warning">ğŸ›¡ï¸ Admin</a>
                                    </Authorized>
                                </AuthorizeView>
                                <a href="/settings" class="btn btn-sm btn-outline-secondary">âš™ï¸ Settings</a>
                                <button type="button" class="btn btn-sm btn-outline-danger" @onclick="HandleLogout">ğŸšª Logout</button>
                            </div>
                        </Authorized>
                        <NotAuthorized>
                            <a href="/Identity/Account/Login" class="btn btn-primary">Sign In</a>
                        </NotAuthorized>
                    </AuthorizeView>
                </div>
                <!-- Mobile Menu Icon -->
                <button class="mobile-settings-toggle d-md-none" @onclick="ToggleMobileMenu" type="button">
                    <span style="font-size: 1.25rem;">âš™ï¸</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay @(showMobileMenu ? "show" : "")" @onclick="ToggleMobileMenu"></div>
    
    <!-- Mobile Menu -->
    <div class="mobile-menu @(showMobileMenu ? "show" : "")">
        <div class="mobile-menu-header">
            <h5 class="mb-0">Menu</h5>
            <button class="mobile-menu-close" @onclick="ToggleMobileMenu" type="button">âœ•</button>
        </div>
        <div class="mobile-menu-body">
            <a href="/dashboard" class="mobile-menu-link" @onclick="ToggleMobileMenu">
                <span class="mobile-menu-icon">ğŸ“Š</span> Dashboard
            </a>
            <a href="/contacts" class="mobile-menu-link" @onclick="ToggleMobileMenu">
                <span class="mobile-menu-icon">ğŸ‘¥</span> Contacts
            </a>
            <a href="/messages" class="mobile-menu-link" @onclick="ToggleMobileMenu">
                <span class="mobile-menu-icon">ğŸ’¬</span> Messages
            </a>
            <a href="/whatsapp/connect" class="mobile-menu-link" @onclick="ToggleMobileMenu">
                <span class="mobile-menu-icon">ğŸ“±</span> WhatsApp
            </a>
            <hr class="my-3" />
            <AuthorizeView>
                <Authorized>
                    <AuthorizeView Roles="Admin" Context="adminLink">
                        <Authorized>
                            <a href="/admin" class="mobile-menu-link" @onclick="ToggleMobileMenu">
                                <span class="mobile-menu-icon">ğŸ›¡ï¸</span> Admin
                            </a>
                        </Authorized>
                    </AuthorizeView>
                    <a href="/settings" class="mobile-menu-link" @onclick="ToggleMobileMenu">
                        <span class="mobile-menu-icon">âš™ï¸</span> Settings
                    </a>
                    <button type="button" class="mobile-menu-link text-danger" @onclick="HandleLogoutMobile" style="border: none; background: none; width: 100%; text-align: left;">
                        <span class="mobile-menu-icon">ğŸšª</span> Logout
                    </button>
                </Authorized>
                <NotAuthorized>
                    <a href="/Identity/Account/Login" class="mobile-menu-link" @onclick="ToggleMobileMenu">
                        <span class="mobile-menu-icon">ğŸ”</span> Sign In
                    </a>
                </NotAuthorized>
            </AuthorizeView>
        </div>
    </div>

    <!-- Main Content -->
    <main class="dashboard-main">
        @Body
    </main>

    <!-- Footer -->
    <footer class="dashboard-footer">
        <div class="container">
            <p class="text-center text-muted mb-0">
                &copy; @DateTime.Now.Year HBDrop - Never forget a birthday again! ğŸ‰
            </p>
        </div>
    </footer>
</div>

@code {
    private bool showMobileMenu = false;

    private void ToggleMobileMenu()
    {
        showMobileMenu = !showMobileMenu;
    }

    private void HandleLogout()
    {
        NavigationManager.NavigateTo("/Identity/Account/Logout", forceLoad: true);
    }

    private void HandleLogoutMobile()
    {
        showMobileMenu = false;
        HandleLogout();
    }
}
